<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>貪食蛇遊戲 - 高度自訂設定</title>
  <style>
    :root{--bg:#0b1220;--board:#0f1724;--snake:#34d399;--head:#059669;--food:#ef4444;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#041024);font-family:system-ui,Segoe UI,Roboto,'Noto Sans TC',sans-serif;color:white}
    .wrap{width:960px;max-width:96vw;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.7)}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .board-row{display:flex;gap:18px}
    .game{background:var(--board);padding:12px;border-radius:8px;display:flex;flex-direction:column;align-items:center}
    canvas{background:linear-gradient(180deg,#051426,#07233a);border-radius:6px;display:block}
    .hud{display:flex;gap:12px;align-items:center;margin-top:10px}
    .muted{color:var(--muted);font-size:13px}
    button{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;color:inherit;cursor:pointer}
    .controls{display:flex;gap:8px;align-items:center}
    .right{display:flex;flex-direction:column;gap:12px;min-width:280px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:8px}
    .score{font-size:24px;font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    input[type=color]{width:40px;height:24px;padding:0;border:none;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>貪食蛇遊戲 - 自訂設定版</h1>
      <div class="muted">可調整敵方數量、顏色及遊戲配色。</div>
    </header>

    <div class="board-row">
      <div class="game">
        <canvas id="game" width="640" height="640"></canvas>
        <div class="hud">
          <div class="controls">
            <button id="start">開始</button>
            <button id="pause">暫停</button>
            <button id="reset">重置</button>
          </div>
          <div style="width:18px"></div>
          <div class="muted">速度</div>
          <input id="speed" type="range" min="4" max="20" value="10">
          <div class="muted" id="speedVal">10</div>
        </div>
      </div>

      <div class="right">
        <div class="panel">
          <div class="small">分數</div>
          <div class="score" id="score">0</div>
          <div style="height:8px"></div>
          <div class="small">紀錄</div>
          <div id="best" class="small">0</div>
        </div>

        <div class="panel">
          <div class="small">遊戲配色</div>
          <div>背景主題：
            <select id="bgTheme">
              <option value="dark">深色</option>
              <option value="light">淺色</option>
              <option value="neon">霓虹</option>
            </select>
          </div>
          <div style="margin-top:6px">玩家蛇：<input type="color" id="playerColor" value="#34d399"></div>
          <div>食物：<input type="color" id="foodColor" value="#ef4444"></div>
        </div>

        <div class="panel">
          <div class="small">敵方設定</div>
          <div>敵方數量：<input type="number" id="enemyCount" min="0" max="5" value="1"></div>
          <div id="enemyColorsContainer" style="margin-top:6px"></div>
          <div>敵方難度：<input type="range" id="enemyLevel" min="1" max="3" value="2"><span id="enemyLevelText">中</span></div>
          <div class="small" id="enemyInfo">分數 0</div>
        </div>

        <div class="panel">
          <label class="small">穿牆模式 <input type="checkbox" id="wrap"></label>
        </div>
      </div>
    </div>
  </div>

  <script>
    const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
    const startBtn=document.getElementById('start'),pauseBtn=document.getElementById('pause'),resetBtn=document.getElementById('reset');
    const scoreEl=document.getElementById('score'),bestEl=document.getElementById('best');
    const speedRange=document.getElementById('speed'),speedVal=document.getElementById('speedVal');
    const wrapChk=document.getElementById('wrap'),enemyInfo=document.getElementById('enemyInfo');
    const enemyCountInput=document.getElementById('enemyCount'),enemyColorsContainer=document.getElementById('enemyColorsContainer');
    const enemyLevel=document.getElementById('enemyLevel'),enemyLevelText=document.getElementById('enemyLevelText');
    const playerColorInput=document.getElementById('playerColor'),foodColorInput=document.getElementById('foodColor'),bgThemeSelect=document.getElementById('bgTheme');

    const CELL=20,COLS=canvas.width/CELL,ROWS=canvas.height/CELL;
    let snake,dir,nextDir,food,score,best,running,paused,lastTick,tickInterval;
    let enemies,enemyDirs,enemyScores,enemyColors,enemyDelay,counter;

    // 初始化設定
    best=Number(localStorage.getItem('snake_best')||0);bestEl.textContent=best;

    function initEnemyColors(){
      enemyColorsContainer.innerHTML='';
      enemyColors=[];
      let count=parseInt(enemyCountInput.value);
      for(let i=0;i<count;i++){
        let input=document.createElement('input');
        input.type='color';
        input.value=['#60a5fa','#facc15','#f87171','#a78bfa','#34d399'][i%5];
        input.dataset.idx=i;
        input.addEventListener('input',()=>{enemyColors[i]=input.value;});
        enemyColors.push(input.value);
        enemyColorsContainer.appendChild(document.createTextNode('敵方'+(i+1)+':'));
        enemyColorsContainer.appendChild(input);
        enemyColorsContainer.appendChild(document.createElement('br'));
      }
    }

    function resetGame(){
      snake=[{x:COLS/2|0,y:ROWS/2|0}];dir={x:1,y:0};nextDir=null;score=0;scoreEl.textContent=score;
      let count=parseInt(enemyCountInput.value);
      enemies=[];enemyDirs=[];enemyScores=[];
      for(let i=0;i<count;i++){enemies.push([{x:(COLS/4)*(i+1)/count|0,y:ROWS/4|0}]);enemyDirs.push({x:1,y:0});enemyScores.push(0);}
      counter=0;enemyDelay=4-enemyLevel.value;
      placeFood();running=false;paused=false;
    }

    function placeFood(){
      while(true){const x=Math.floor(Math.random()*COLS),y=Math.floor(Math.random()*ROWS);
        if(!snake.some(s=>s.x===x&&s.y===y)&&!enemies.some(e=>e.some(s=>s.x===x&&s.y===y))){food={x,y};return;}}
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      let bgColor='#051426';if(bgThemeSelect.value==='light')bgColor='#f0f0f0';if(bgThemeSelect.value==='neon')bgColor='#0c0c0c';
      ctx.fillStyle=bgColor;ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle=playerColorInput.value;for(let s of snake)ctx.fillRect(s.x*CELL+2,s.y*CELL+2,CELL-4,CELL-4);
      for(let i=0;i<enemies.length;i++){ctx.fillStyle=enemyColors[i];for(let s of enemies[i])ctx.fillRect(s.x*CELL+2,s.y*CELL+2,CELL-4,CELL-4);}
      ctx.fillStyle=foodColorInput.value;ctx.fillRect(food.x*CELL+3,food.y*CELL+3,CELL-6,CELL-6);
    }

    function step(){
      if(nextDir&&!(-nextDir.x===dir.x&&-nextDir.y===dir.y))dir=nextDir;
      let head={x:snake.at(-1).x+dir.x,y:snake.at(-1).y+dir.y};
      if(wrapChk.checked){head.x=(head.x+COLS)%COLS;head.y=(head.y+ROWS)%ROWS;}
      if(!wrapChk.checked&&(head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS))return gameOver();
      if(snake.some(s=>s.x===head.x&&s.y===head.y)||enemies.some(e=>e.some(s=>s.x===head.x&&s.y===head.y)))return gameOver();
      snake.push(head);
      if(food&&head.x===food.x&&head.y===food.y){score+=10;scoreEl.textContent=score;placeFood();if(score>best){best=score;localStorage.setItem('snake_best',best);bestEl.textContent=best;}}else snake.shift();
      counter++;if(counter>=enemyDelay){enemyStep();counter=0;}
    }

    function enemyStep(){
      for(let i=0;i<enemies.length;i++){
        let ehead={...enemies[i].at(-1)};
        let dx=food.x-ehead.x,dy=food.y-ehead.y;
        let dirChoice=enemyLevel.value==3?0:enemyLevel.value==1?1:Math.random()<0.5?0:1;
        let eDir={x:0,y:0};
        if(dirChoice===0)eDir=Math.abs(dx)>Math.abs(dy)?{x:dx>0?1:-1,y:0}:{x:0,y:dy>0?1:-1};
        else{let dirs=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];eDir=dirs[Math.floor(Math.random()*4)];}
        let newHead={x:ehead.x+eDir.x,y:ehead.y+eDir.y};
        if(wrapChk.checked){newHead.x=(newHead.x+COLS)%COLS;newHead.y=(newHead.y+ROWS)%ROWS;}
        if(!wrapChk.checked&&(newHead.x<0||newHead.x>=COLS||newHead.y<0||newHead.y>=ROWS))continue;
        if(enemies[i].some(s=>s.x===newHead.x&&s.y===newHead.y))continue;
        enemies[i].push(newHead);
        if(food&&newHead.x===food.x&&newHead.y===food.y){enemyScores[i]+=10;enemyInfo.textContent='分數 '+enemyScores.reduce((a,b)=>a+b,0);placeFood();}else enemies[i].shift();
        if(newHead.x===snake.at(-1).x&&newHead.y===snake.at(-1).y)return gameOver();
      }
    }

    function gameOver(){running=false;paused=false;alert('遊戲結束！你的分數：'+score+'\n敵方總分：'+enemyScores.reduce((a,b)=>a+b,0));}

    function gameLoop(ts){if(!lastTick)lastTick=ts;let e=ts-lastTick;if(running&&!paused&&e>=tickInterval){step();draw();lastTick=ts;}requestAnimationFrame(gameLoop);}

    window.addEventListener('keydown',e=>{let k=e.key.toLowerCase();if(['arrowup','w'].includes(k))nextDir={x:0,y:-1};if(['arrowdown','s'].includes(k))nextDir={x:0,y:1};if(['arrowleft','a'].includes(k))nextDir={x:-1,y:0};if(['arrowright','d'].includes(k))nextDir={x:1,y:0};if(k===' ')paused=!paused;});

    startBtn.onclick=()=>{if(!running){running=true;paused=false;lastTick=0;}};
    pauseBtn.onclick=()=>{paused=!paused;};
    resetBtn.onclick=()=>{initEnemyColors();resetGame();draw();};
    speedRange.oninput=()=>{speedVal.textContent=speedRange.value;tickInterval=1000/Number(speedRange.value);};
    enemyLevel.oninput=()=>{enemyDelay=4-enemyLevel.value;enemyLevelText.textContent=enemyLevel.value==1?'簡單':enemyLevel.value==2?'中':'困難';};
    enemyCountInput.oninput=()=>{initEnemyColors();};

    tickInterval=1000/Number(speedRange.value);initEnemyColors();resetGame();draw();requestAnimationFrame(gameLoop);
  </script>
</body>
</html>